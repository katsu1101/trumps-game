(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1793:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>E});var l=a(5155),s=a(2115),r=a(5453);let c=["spade","heart","diamond","club"],n=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],o=()=>c.flatMap(e=>n.map(t=>({id:"".concat(e,"-").concat(t),suit:e,rank:t,location:"deck",isFaceUp:!1}))),i=e=>[...e].sort(()=>Math.random()-.5),d=e=>{let{npcCount:t,setCardLocation:a}=x.getState(),l=1+t,s=Array.from({length:l},()=>[]);e.forEach((e,t)=>{s[t%l].push(e)}),s.forEach((e,t)=>{let l=0===t?"player":"npc".concat(t-1),s=0===t;e.forEach(e=>{a(e.id,l,s)})})},p=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"random",l=e.filter(e=>e.location===t&&e.isPlayable);if(0!==l.length)switch(a){case"random":return l[Math.floor(Math.random()*l.length)];case"edge":{let e=l.map(e=>{let t=u(e.rank);return{card:e,score:Math.max(t,f.length-1-t)}});return e.sort((e,t)=>t.score-e.score),e[0].card}case"center":{let e=l.map(e=>{let t=Math.abs(u(e.rank)-6);return{card:e,score:t}});return e.sort((e,t)=>e.score-t.score),e[0].card}default:return l[0]}},f=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],u=e=>f.indexOf(e),x=(0,r.v)((e,t)=>({npcCount:4,cards:[],phase:"dealing",turnIndex:0,setNpcCount:t=>{t>=2&&t<=4&&e({npcCount:t})},setCardLocation:function(t,a){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e(e=>({cards:e.cards.map(e=>e.id===t?{...e,location:a,isFaceUp:l}:e)}))},dealCards:()=>{let a=1+t().npcCount,l=o().sort(()=>Math.random()-.5),s=Array.from({length:a},()=>[]);l.forEach((e,t)=>{s[t%a].push(e)}),e({cards:s.flatMap((e,t)=>{let a=0===t?"player":"npc".concat(t-1),l=0===t;return e.map(e=>({...e,location:a,isFaceUp:l}))})})},playRandomToField:()=>{let a=[...t().cards],l=a.filter(e=>e.location.startsWith("npc")||"player"===e.location);if(0===l.length)return;let s=Math.floor(Math.random()*l.length),r=l[s];e({cards:a.map(e=>e===r?{...e,location:"field",isFaceUp:!0}:e)})},collectFieldToDeck:()=>{e({cards:t().cards.map(e=>"field"===e.location?{...e,location:"deck",isFaceUp:!1}:e)})},dealNextCard:()=>{let{cards:a,npcCount:l}=t(),s=a.findLast(e=>"deck"===e.location);if(!s)return;let r=(a.length-a.filter(e=>"deck"===e.location).length)%(1+l),c=0===r?"player":"npc".concat(r-1),n="player"===c;e({cards:a.map(e=>e.id===s.id?{...e,location:c,isFaceUp:n}:e)})},drawCard:()=>{let a=t(),l=a.cards.find(e=>"deck"===e.location);l&&e({cards:a.cards.map(e=>e.id===l.id?{...e,location:"player",isFaceUp:!0}:e)})},startGame:t=>{let a=i(o());e({cards:a,phase:"auto"===t?"dealing":"ready"}),"instant"===t&&d(a)},sortPlayerHand:()=>e(e=>{let t=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];return{cards:[...e.cards.filter(e=>"player"===e.location).sort((e,a)=>e.suit!==a.suit?e.suit.localeCompare(a.suit):t.indexOf(e.rank)-t.indexOf(a.rank)),...e.cards.filter(e=>"player"!==e.location)]}}),playNext7ToField:()=>e(e=>({cards:e.cards.map(e=>"7"===e.rank?{...e,location:"field",isFaceUp:!0}:e)})),playNextToField:()=>e(e=>{let t=1+e.npcCount,a=e.turnIndex%t,l=0===a?"player":"npc".concat(a-1),s=p(e.cards,l,"player"===l?"edge":"npc1"===l?"random":"npc2"===l?"center":"first");return s?{cards:e.cards.map(e=>e.id===s.id?{...e,location:"field",isFaceUp:!0}:e),turnIndex:(e.turnIndex+1)%t}:{turnIndex:(e.turnIndex+1)%t}}),playNextToDeck:()=>e(e=>({cards:e.cards.map(e=>({...e,location:"deck",isFaceUp:!1}))})),updatePlayableFlags:()=>{let a=t().cards,l=new Map;a.forEach(e=>{if("field"===e.location){let t=u(e.rank),a=l.get(e.suit)||[];l.set(e.suit,[...a,t])}}),e({cards:a.map(e=>{if("player"!==e.location&&!e.location.startsWith("npc"))return{...e,isPlayable:!1};let t=u(e.rank),a=l.get(e.suit)||[];if(!a.includes(6))return{...e,isPlayable:"7"===e.rank};let s=a.slice().sort((e,t)=>e-t),r=!1,c=6;for(;s.includes(c);)c++;c<f.length&&c===t&&(r=!0);let n=6;for(;s.includes(n);)n--;return n>=0&&n===t&&(r=!0),{...e,isPlayable:r}})})}})),h=e=>new Promise(t=>setTimeout(t,e)),m=()=>{let e=x(e=>e.dealNextCard),t=x(e=>e.sortPlayerHand),a=x(e=>e.playNextToField),l=x(e=>e.playNext7ToField),r=x(e=>e.playNextToDeck),c=x(e=>e.phase);(0,s.useEffect)(()=>{let s=!1;return(async()=>{switch(console.log("phase",c),c){case"dealing":await h(100),x.setState({phase:"demo1"});break;case"demo1":for(;!s;)if(x.getState().cards.filter(e=>"deck"===e.location).length>0)e(),await h(100);else{t(),await h(500),x.setState({phase:"demo2"});break}break;case"demo2":l(),await h(500),x.setState({phase:"demo3"});break;case"demo3":for(;!s;)if(x.getState().updatePlayableFlags(),x.getState().cards.filter(e=>"player"===e.location||e.location.startsWith("npc")).length>0)a(),x.getState().updatePlayableFlags(),await h(1e3);else{await h(5e3),x.setState({phase:"demo4"});break}break;case"demo4":r(),await h(5e3),x.setState({phase:"demo1"});break;default:console.log("phase: ".concat(c))}})(),()=>{s=!0}},[c,e,t,a,l,r])};var g=a(760),b=a(6413),y=a(2596);let N={1:[{top:"50%",left:"50%"}],2:[{top:"20%",left:"50%"},{top:"80%",left:"50%"}],3:[{top:"20%",left:"50%"},{top:"50%",left:"50%"},{top:"80%",left:"50%"}],4:[{top:"20%",left:"35%"},{top:"20%",left:"65%"},{top:"80%",left:"35%"},{top:"80%",left:"65%"}],5:[{top:"20%",left:"35%"},{top:"20%",left:"65%"},{top:"50%",left:"50%"},{top:"80%",left:"35%"},{top:"80%",left:"65%"}],6:[{top:"20%",left:"35%"},{top:"50%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"50%",left:"65%"},{top:"80%",left:"65%"}],7:[{top:"20%",left:"35%"},{top:"50%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"50%",left:"65%"},{top:"80%",left:"65%"},{top:"35%",left:"50%"}],8:[{top:"20%",left:"35%"},{top:"40%",left:"35%"},{top:"60%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"40%",left:"65%"},{top:"60%",left:"65%"},{top:"80%",left:"65%"}],9:[{top:"20%",left:"35%"},{top:"40%",left:"35%"},{top:"60%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"40%",left:"65%"},{top:"60%",left:"65%"},{top:"80%",left:"65%"},{top:"50%",left:"50%"}],10:[{top:"20%",left:"35%"},{top:"35%",left:"35%"},{top:"50%",left:"35%"},{top:"65%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"35%",left:"65%"},{top:"50%",left:"65%"},{top:"65%",left:"65%"},{top:"80%",left:"65%"}]};function j(e){let{card:t,className:a,style:s}=e,r={spade:"♠",heart:"♥",diamond:"♦",club:"♣"},c="heart"===t.suit||"diamond"===t.suit?"text-red-500":"text-black",n="A"==t.rank?1:parseInt(t.rank),o=!isNaN(n)&&n>=1&&n<=10;return(0,l.jsx)(b.P.div,{layout:!0,layoutId:t.id,className:(0,y.$)("w-12 h-[72px] border rounded bg-white shadow-sm",a),style:s,children:t.isFaceUp?(0,l.jsxs)(l.Fragment,{children:[("diamond"===t.suit||"heart"===t.suit)&&("A"===t.rank||"J"===t.rank||"Q"===t.rank||"K"===t.rank)&&(0,l.jsx)("img",{src:"".concat("/trumps-game","/img/").concat(t.suit,"_").concat(t.rank,".png"),alt:"",className:"absolute left-0 right-0 mx-auto h-auto max-h-full object-contain",style:{top:"50%",transform:"translateY(-50%)"}}),(0,l.jsxs)("div",{className:"absolute top-1 left-1 leading-none flex flex-col ".concat(c),children:[(0,l.jsx)("span",{className:"font-bold text-[13px] ".concat("10"===t.rank?"-translate-x-[5px]":""),children:t.rank}),(0,l.jsx)("span",{className:"text-[12px]",children:r[t.suit]})]}),(0,l.jsxs)("div",{className:"absolute bottom-1 right-1 leading-none flex flex-col ".concat(c," rotate-180"),children:[(0,l.jsx)("span",{className:"font-bold text-[13px] ".concat("10"===t.rank?"-translate-x-[5px]":""),children:t.rank}),(0,l.jsx)("span",{className:"text-[12px]",children:r[t.suit]})]}),o&&N[n]&&(0,l.jsx)("div",{className:"absolute inset-0",children:N[n].map((e,a)=>(0,l.jsx)("span",{className:(0,y.$)(1==n?"text-[28px]":"text-[15px]","absolute ".concat(c)),style:{top:e.top,left:e.left,transform:"translate(-50%, -50%)"},children:r[t.suit]},a))})]}):(0,l.jsx)("div",{className:"bg-blue-900 w-full h-full rounded"})})}function k(e){let{cards:t,label:a,cardWidth:r=80}=e,c=(0,s.useRef)(null),[n,o]=(0,s.useState)(600);(0,s.useEffect)(()=>{let e=()=>{c.current&&o(c.current.offsetWidth)};e();let t=new ResizeObserver(e);return c.current&&t.observe(c.current),()=>t.disconnect()},[]);let i=(0,s.useMemo)(()=>t.length*r<=n?r:Math.max((n-r-10)/(t.length-1),20),[t.length,r,n]);return(0,l.jsxs)("div",{className:"relative flex flex-col items-center h-full w-full border border-dashed pt-3 pl-3",ref:c,children:[a&&(0,l.jsx)("div",{className:"absolute z-50 bg-black/60 top-0 left-0 text-xs text-white px-1",children:a}),(0,l.jsx)("div",{className:"relative h-[85px] overflow-hidden",style:{width:"100%",maxWidth:"100%"},children:(0,l.jsx)(g.N,{mode:"popLayout",children:t.map((e,t)=>(0,l.jsx)(j,{card:e,className:"absolute top-0",style:{left:"".concat(t*i,"px"),top:e.isPlayable&&e.isFaceUp?"0px":"12px",zIndex:t}},e.id))})})]})}function v(){let e=x(e=>e.cards),t=x(e=>e.npcCount);return(0,l.jsx)("div",{className:"flex w-full",children:Array.from({length:t},(t,a)=>{let s=e.filter(e=>e.location==="npc".concat(a));return(0,l.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center",children:(0,l.jsx)(k,{cards:s,label:"NPC ".concat(a+1)},"npc".concat(a))},"npc".concat(a))})})}let w=e=>{switch(e){case"A":return 0;case"J":return 10;case"Q":return 11;case"K":return 12;default:return parseInt(e,10)-1}},F=e=>{switch(e){case"spade":default:return 0;case"heart":return 1;case"diamond":return 2;case"club":return 3}};function C(){let e=x(e=>e.cards),t=e.filter(e=>"deck"===e.location),a=e.filter(e=>"field"===e.location);return(0,l.jsxs)("div",{className:"flex justify-between items-center h-full p-2",children:[(0,l.jsx)("div",{className:"relative flex flex-col items-center gap-1 w-20",children:(0,l.jsx)("div",{className:"relative w-16 h-24",children:(0,l.jsx)(g.N,{mode:"popLayout",children:t.map((e,t)=>(0,l.jsx)("div",{className:"absolute",style:{top:-(.25*t),left:-(.1*t),zIndex:100+t},children:(0,l.jsx)(j,{card:e})},e.id))})})}),(0,l.jsx)("div",{className:"flex h-full flex-col items-center gap-1 flex-1",children:(0,l.jsx)("div",{className:"relative h-full grid grid-cols-13 gap-[2px] p-2 rounded overflow-hidden border text-black",style:{display:"grid",gridTemplateColumns:"repeat(13, 48px)",gap:"4px",justifyContent:"center"},children:(0,l.jsx)(g.N,{mode:"popLayout",children:a.map((e,t)=>(0,l.jsx)(j,{card:e,className:"absolute",style:{left:"".concat(53*w(e.rank),"px"),top:"".concat(74*F(e.suit),"px"),zIndex:t}},e.id))})})}),(0,l.jsx)("div",{className:"flex flex-col items-center gap-1"})]})}function M(){let e=x(e=>e.cards),t=(0,s.useMemo)(()=>e.filter(e=>"player"===e.location),[e]);return(0,l.jsxs)("div",{className:"flex justify-between items-center h-full",children:[(0,l.jsx)("div",{className:"flex flex-col items-center gap-1 w-100"}),(0,l.jsx)(k,{cards:t,label:"\uD83E\uDDD1 プレイヤー"}),(0,l.jsx)("div",{className:"flex flex-col items-center gap-1 w-100"})]})}function P(){return m(),(0,l.jsxs)("main",{className:"flex flex-col h-screen bg-green-900 text-white",children:[(0,l.jsx)("section",{className:"h-[120px]",children:(0,l.jsx)(v,{})}),(0,l.jsx)("section",{className:"h-[320px]",children:(0,l.jsx)(C,{})}),(0,l.jsx)("section",{className:"h-[120px]",children:(0,l.jsx)(M,{})})]})}function E(){let e=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{e.current||(x.getState().startGame("auto"),e.current=!0)},[]),(0,l.jsx)(P,{})}},2659:(e,t,a)=>{Promise.resolve().then(a.bind(a,1793))}},e=>{var t=t=>e(e.s=t);e.O(0,[51,441,684,358],()=>t(2659)),_N_E=e.O()}]);