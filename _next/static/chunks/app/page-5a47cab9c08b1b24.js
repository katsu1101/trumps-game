(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2659:(e,t,a)=>{Promise.resolve().then(a.bind(a,5864))},5864:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>I});var l=a(5155);let r=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],s=["spade","heart","diamond","club"],c=e=>r.indexOf(e),o=e=>s.indexOf(e);var n=a(5453);let i=()=>s.flatMap(e=>r.map(t=>({id:"".concat(e,"-").concat(t),suit:e,rank:t,location:"deck",isFaceUp:!1}))),d=e=>[...e].sort(()=>Math.random()-.5),p=e=>{let{npcCount:t,setCardLocation:a}=u.getState(),l=1+t,r=Array.from({length:l},()=>[]);e.forEach((e,t)=>{r[t%l].push(e)}),r.forEach((e,t)=>{let l=0===t?"player":"npc".concat(t-1),r=0===t;e.forEach(e=>{a(e.id,l,r)})})},f=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"random",l=e.filter(e=>e.location===t&&e.isPlayable);if(0!==l.length)switch(a){case"random":return l[Math.floor(Math.random()*l.length)];case"edge":{let e=l.map(e=>{let t=c(e.rank);return{card:e,score:Math.max(t,r.length-1-t)}});return e.sort((e,t)=>t.score-e.score),e[0].card}case"center":{let e=l.map(e=>{let t=Math.abs(c(e.rank)-6);return{card:e,score:t}});return e.sort((e,t)=>e.score-t.score),e[0].card}default:return l[0]}},u=(0,n.v)((e,t)=>({npcCount:3,cards:[],phase:"dealing",turnIndex:0,setNpcCount:t=>{t>=2&&t<=4&&e({npcCount:t})},setCardLocation:function(t,a){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e(e=>({cards:e.cards.map(e=>e.id===t?{...e,location:a,isFaceUp:l}:e)}))},dealCards:()=>{let a=1+t().npcCount,l=i().sort(()=>Math.random()-.5),r=Array.from({length:a},()=>[]);l.forEach((e,t)=>{r[t%a].push(e)}),e({cards:r.flatMap((e,t)=>{let a=0===t?"player":"npc".concat(t-1),l=0===t;return e.map(e=>({...e,location:a,isFaceUp:l}))})})},playRandomToField:()=>{let a=[...t().cards],l=a.filter(e=>e.location.startsWith("npc")||"player"===e.location);if(0===l.length)return;let r=Math.floor(Math.random()*l.length),s=l[r];e({cards:a.map(e=>e===s?{...e,location:"field",isFaceUp:!0}:e)})},collectFieldToDeck:()=>{e({cards:t().cards.map(e=>"field"===e.location?{...e,location:"deck",isFaceUp:!1}:e)})},dealNextCard:()=>{let{cards:a,npcCount:l}=t(),r=a.findLast(e=>"deck"===e.location);if(!r)return;let s=(a.length-a.filter(e=>"deck"===e.location).length)%(1+l),c=0===s?"player":"npc".concat(s-1),o="player"===c;e({cards:a.map(e=>e.id===r.id?{...e,location:c,isFaceUp:o}:e)})},drawCard:()=>{let a=t(),l=a.cards.find(e=>"deck"===e.location);l&&e({cards:a.cards.map(e=>e.id===l.id?{...e,location:"player",isFaceUp:!0}:e)})},startGame:t=>{let a=d(i());e({cards:a,phase:"auto"===t?"dealing":"ready"}),"instant"===t&&p(a)},sortPlayerHand:()=>e(e=>({cards:[...e.cards.filter(e=>"player"===e.location).sort((e,t)=>e.suit!==t.suit?o(e.suit)-o(t.suit):c(e.rank)-c(t.rank)),...e.cards.filter(e=>"player"!==e.location)]})),playNext7ToField:()=>e(e=>({cards:e.cards.map(e=>"7"===e.rank?{...e,location:"field",isFaceUp:!0}:e)})),playNextToField:()=>e(e=>{let t=1+e.npcCount,a=e.turnIndex%t,l=0===a?"player":"npc".concat(a-1),r=f(e.cards,l,"player"===l?"edge":"npc1"===l?"random":"npc2"===l?"center":"first");return r?{cards:e.cards.map(e=>e.id===r.id?{...e,location:"field",isFaceUp:!0}:e),turnIndex:(e.turnIndex+1)%t}:{turnIndex:(e.turnIndex+1)%t}}),playNextToDeck:()=>e(e=>({cards:e.cards.map(e=>({...e,location:"deck",isFaceUp:!1}))})),updatePlayableFlags:()=>{let a=t().cards,l=new Map;a.forEach(e=>{if("field"===e.location){let t=c(e.rank),a=l.get(e.suit)||[];l.set(e.suit,[...a,t])}}),e({cards:a.map(e=>{if("player"!==e.location&&!e.location.startsWith("npc"))return{...e,isPlayable:!1};let t=c(e.rank),a=l.get(e.suit)||[];if(!a.includes(6))return{...e,isPlayable:"7"===e.rank};let s=a.slice().sort((e,t)=>e-t),o=!1,n=6;for(;s.includes(n);)n++;n<r.length&&n===t&&(o=!0);let i=6;for(;s.includes(i);)i--;return i>=0&&i===t&&(o=!0),{...e,isPlayable:o}})})}}));var h=a(2115);let x=e=>new Promise(t=>setTimeout(t,e)),m=()=>{let e=u(e=>e.dealNextCard),t=u(e=>e.sortPlayerHand),a=u(e=>e.playNextToField),l=u(e=>e.playNext7ToField),r=u(e=>e.playNextToDeck),s=u(e=>e.phase);(0,h.useEffect)(()=>{let c=!1;return(async()=>{switch(console.log("phase",s),s){case"dealing":await x(100),u.setState({phase:"demo1"});break;case"demo1":for(;!c;)if(u.getState().cards.filter(e=>"deck"===e.location).length>0)e(),await x(100);else{t(),await x(500),u.setState({phase:"demo2"});break}break;case"demo2":l(),await x(500),u.setState({phase:"demo3"});break;case"demo3":for(;!c;)if(u.getState().updatePlayableFlags(),u.getState().cards.filter(e=>"player"===e.location||e.location.startsWith("npc")).length>0)a(),u.getState().updatePlayableFlags(),await x(1e3);else{await x(5e3),u.setState({phase:"demo4"});break}break;case"demo4":r(),await x(5e3),u.setState({phase:"demo1"});break;default:console.log("phase: ".concat(s))}})(),()=>{c=!0}},[s,e,t,a,l,r])},g={1:[{top:"50%",left:"50%"}],2:[{top:"20%",left:"50%"},{top:"80%",left:"50%"}],3:[{top:"20%",left:"50%"},{top:"50%",left:"50%"},{top:"80%",left:"50%"}],4:[{top:"20%",left:"35%"},{top:"20%",left:"65%"},{top:"80%",left:"35%"},{top:"80%",left:"65%"}],5:[{top:"20%",left:"35%"},{top:"20%",left:"65%"},{top:"50%",left:"50%"},{top:"80%",left:"35%"},{top:"80%",left:"65%"}],6:[{top:"20%",left:"35%"},{top:"50%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"50%",left:"65%"},{top:"80%",left:"65%"}],7:[{top:"20%",left:"35%"},{top:"50%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"50%",left:"65%"},{top:"80%",left:"65%"},{top:"35%",left:"50%"}],8:[{top:"20%",left:"35%"},{top:"40%",left:"35%"},{top:"60%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"40%",left:"65%"},{top:"60%",left:"65%"},{top:"80%",left:"65%"}],9:[{top:"20%",left:"35%"},{top:"40%",left:"35%"},{top:"60%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"40%",left:"65%"},{top:"60%",left:"65%"},{top:"80%",left:"65%"},{top:"50%",left:"50%"}],10:[{top:"20%",left:"35%"},{top:"35%",left:"35%"},{top:"50%",left:"35%"},{top:"65%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"35%",left:"65%"},{top:"50%",left:"65%"},{top:"65%",left:"65%"},{top:"80%",left:"65%"}]};var v=a(2596),w=a(6413),y=a(6766);function b(e){let{card:t,className:a,style:r}=e,s={spade:"♠",heart:"♥",diamond:"♦",club:"♣"},c="heart"===t.suit||"diamond"===t.suit?"text-red-500":"text-black",o="A"==t.rank?1:parseInt(t.rank),n=!isNaN(o)&&o>=1&&o<=10;return(0,l.jsx)(w.P.div,{layout:!0,layoutId:t.id,className:(0,v.$)("bg-white border rounded shadow-sm","w-[15vw] aspect-[0.7] min-w-[30px] max-w-[50px]","flex-shrink-0",a),style:r,children:t.isFaceUp?(0,l.jsxs)(l.Fragment,{children:[("diamond"===t.suit||"heart"===t.suit)&&["A","J","Q","K"].includes(t.rank)&&(0,l.jsx)(y.default,{src:"".concat("/trumps-game","/img/").concat(t.suit,"_").concat(t.rank,".png"),alt:"",width:100,height:100,className:"absolute left-0 right-0 mx-auto h-auto max-h-full object-contain",style:{top:"50%",transform:"translateY(-50%)"}}),(0,l.jsxs)("div",{className:"absolute top-[5%] left-[5%] leading-none flex flex-col ".concat(c),children:[(0,l.jsx)("span",{className:(0,v.$)("font-bold text-[0.8em]","10"===t.rank&&"-translate-x-[0.2em]"),children:t.rank}),(0,l.jsx)("span",{className:"text-[0.7em]",children:s[t.suit]})]}),(0,l.jsxs)("div",{className:"absolute bottom-[5%] right-[5%] leading-none flex flex-col ".concat(c," rotate-180"),children:[(0,l.jsx)("span",{className:(0,v.$)("font-bold text-[0.8em]","10"===t.rank&&"-translate-x-[0.2em]"),children:t.rank}),(0,l.jsx)("span",{className:"text-[0.7em]",children:s[t.suit]})]}),n&&g[o]&&(0,l.jsx)("div",{className:"absolute inset-0",children:g[o].map((e,a)=>(0,l.jsx)("span",{className:(0,v.$)(1===o?"text-[2em]":"text-[1.2em]","absolute ".concat(c," card-font")),style:{top:e.top,left:e.left,transform:"translate(-50%, -50%)"},children:s[t.suit]},a))})]}):(0,l.jsx)("div",{className:"bg-blue-900 w-full h-full rounded"})})}let N=()=>{let[e,t]=(0,h.useState)(0);return(0,h.useEffect)(()=>{let e=()=>t(window.innerWidth);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e};var j=a(760);let k=e=>{switch(e){case"A":return 0;case"J":return 10;case"Q":return 11;case"K":return 12;default:return parseInt(e,10)-1}},F=e=>{switch(e){case"spade":default:return 0;case"heart":return 1;case"diamond":return 2;case"club":return 3}};function C(){let e=u(e=>e.cards),t=e.filter(e=>"deck"===e.location),a=e.filter(e=>"field"===e.location),r=640>N(),s=r?24:48,c=r?36:72,o=r?2:4;return(0,l.jsxs)("div",{className:"flex h-full w-full flex-row landscape:flex-row portrait:flex-col   items-center justify-center gap-4",children:[(0,l.jsx)("div",{className:"relative flex flex-col items-center gap-1 w-20 portrait:h-[6vh]",children:(0,l.jsx)("div",{className:"relative w-16 h-24",children:(0,l.jsx)(j.N,{mode:"popLayout",children:t.map((e,t)=>(0,l.jsx)("div",{className:(0,v.$)("absolute",r?"scale-50":""),style:{top:-(.25*t),left:-(.1*t),zIndex:100+t},children:(0,l.jsx)(b,{card:e})},e.id))})})}),(0,l.jsx)("div",{className:"flex flex-col items-center flex-1 landscape:h-[55vh] portrait:h-[24vh]",children:(0,l.jsx)("div",{className:"relative h-full grid grid-cols-13 gap-[2px] p-2 rounded overflow-hidden border text-black",style:{display:"grid",gridTemplateColumns:"repeat(13, ".concat(s,"px)"),gap:"".concat(o,"px"),justifyContent:"center"},children:(0,l.jsx)(j.N,{mode:"popLayout",children:a.map((e,t)=>(0,l.jsx)(b,{card:e,className:(0,v.$)("absolute",r?"scale-50":""),style:{left:"".concat(k(e.rank)*(s+o),"px"),top:"".concat(F(e.suit)*(c+o),"px"),zIndex:t}},e.id))})})}),(0,l.jsx)("div",{className:"flex flex-col items-center gap-1"})]})}function E(e){let{cards:t,label:a,isCompact:r=!1,cardWidth:s=80}=e,c=(0,h.useRef)(null),[o,n]=(0,h.useState)(600);(0,h.useEffect)(()=>{let e=()=>{c.current&&n(c.current.offsetWidth)};e();let t=new ResizeObserver(e);return c.current&&t.observe(c.current),()=>t.disconnect()},[]);let i=(0,h.useMemo)(()=>t.length*s<=o?s:Math.max((o-s-5)/(t.length-1),10),[t.length,s,o]);return(0,l.jsxs)("div",{className:"relative flex flex-col items-center h-full w-full border border-dashed pt-3 pl-3",ref:c,children:[a&&(0,l.jsx)("div",{className:"absolute z-50 bg-black/60 top-0 left-0 text-xs text-white px-1",children:a}),(0,l.jsx)("div",{className:(0,v.$)("relative overflow-hidden w-full",r?"h-[55px]":"h-[85px]"),style:{width:"100%",maxWidth:"100%"},children:(0,l.jsx)(j.N,{mode:"popLayout",children:t.map((e,t)=>(0,l.jsx)(b,{card:e,className:(0,v.$)("absolute top-0",r?"scale-50":""),style:{left:"".concat(t*i,"px"),top:e.isPlayable&&e.isFaceUp?"0px":r?"-10px":"12px",zIndex:t}},e.id))})})]})}function M(){let e=u(e=>e.cards),t=u(e=>e.npcCount),a=640>N(),r=Array.from({length:t},(t,r)=>{let s=e.filter(e=>e.location==="npc".concat(r));return(0,l.jsx)("div",{className:"flex-1 flex-col items-center justify-center",children:(0,l.jsx)(E,{cards:s,label:"NPC ".concat(r+1),isCompact:a})},"npc".concat(r))}),s=(()=>{switch(t){case 2:return"portrait:grid portrait:grid-cols-2 portrait:grid-rows-1";case 3:return"portrait:grid portrait:grid-cols-2 portrait:grid-rows-2 portrait:[&>div:nth-child(1)]:col-span-2 portrait:[&>div:nth-child(1)]:justify-center";case 4:return"portrait:grid portrait:grid-cols-2 portrait:grid-rows-2";default:return"portrait:flex portrait:flex-row"}})();return(0,l.jsx)("div",{className:"w-full landscape:flex landscape:flex-row gap-1 ".concat(s),children:r})}function P(){let e=u(e=>e.cards),t=(0,h.useMemo)(()=>e.filter(e=>"player"===e.location),[e]);return(0,l.jsxs)("div",{className:"flex justify-between items-center h-full",children:[(0,l.jsx)("div",{className:"flex flex-col items-center gap-1 landscape:w-[20vw]"}),(0,l.jsx)(E,{cards:t,label:"\uD83E\uDDD1 プレイヤー",isCompact:!1}),(0,l.jsx)("div",{className:"flex flex-col items-center gap-1 landscape:w-[20vw]"})]})}function S(){return m(),(0,l.jsxs)("main",{className:"flex-col h-screen bg-green-900 text-white",children:[(0,l.jsx)("section",{className:"landscape:h-[21vh] portrait:h-[20vh]",children:(0,l.jsx)(M,{})}),(0,l.jsx)("section",{className:"landscape:h-[58vh] portrait:h-[42vh]",children:(0,l.jsx)(C,{})}),(0,l.jsx)("section",{className:"landscape:h-[21vh] portrait:h-[15vh]",children:(0,l.jsx)(P,{})})]})}function I(){let e=(0,h.useRef)(!1);return(0,h.useEffect)(()=>{e.current||(u.getState().startGame("auto"),e.current=!0)},[]),(0,l.jsx)(S,{})}}},e=>{var t=t=>e(e.s=t);e.O(0,[411,441,684,358],()=>t(2659)),_N_E=e.O()}]);