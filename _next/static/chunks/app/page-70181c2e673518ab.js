(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{562:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>M});var r=a(5155);let l=[{id:"player",name:"とじょりん",strategy:{type:"center",passChance:0},img:"heart_Q",colors:{background:"#FFCCCC",text:"#660000",border:"#FF6666"},lines:{start:["こんこんりんか～","おはおはりんか～"],pass:["止めてるの誰？（パス）","建設員ならわかってるよね？ ね？（パス）"],giveUp:["そうんな～（ギブアップ）","もう一回！（ギブアップ）"],win:["やった！上がり～！","いえーい！"]}},{id:"npc1",name:"むぅむぅ",strategy:{type:"first",passChance:20},img:"heart_A",colors:{background:"#FFE0E0",text:"#552222",border:"#FF9999"},lines:{start:["むむぅむ！","むぅ！"],pass:["むむぅ（パス）","むぅ（パス）"],giveUp:["むぅぅ（ギブアップ）","むむぅむぅ（ギブアップ）"],win:["むぅむぅ！","むぅぅ～～！"]}},{id:"npc2",name:"ばけごろう",strategy:{type:"edge",passChance:10},img:"heart_K",colors:{background:"#F0F8FF",text:"#003366",border:"#A3D3F5"},lines:{start:["がんばるんだばけ〜！ヘ(・。・ヘ)♡ふふぅ","きょうももよろしくなんだばけ〜！ヘ(・。・ヘ)♡えへへ"],playCard:["いくんだばけ〜！ヘ(・。・ヘ)♡","これできまりなんだばけ〜！ヘ(・。・ヘ)♡"],pass:["パスするんだばけ〜！ヘ(・。・ヘ)♡","つぎなんだばけ〜！ヘ(・。・ヘ)♡（パス）"],giveUp:["しっぱいなんてないよ〜じんせいはいちどきり〜ヘ(・。・ヘ)♡（ギブアップ）","ボグ、やっぱりむじゅかしかったんだばけ〜ヘ(・。・ヘ)♡（ギブアップ）"],win:["ボグのかちなんだばけ〜！ヘ(・。・ヘ)♡やったやった〜","わ〜いわ〜い〜ヘ(・。・ヘ)♡"]}},{id:"npc3",name:"ミニばけ",strategy:{type:"random",passChance:50},img:"heart_J",colors:{background:"#FFF5E5",text:"#8B4000",border:"#E6B27A"},lines:{start:["ぷににぃ！（ミニばけ、がんばっちゃうぷに！）","ぷにぃ〜！（お兄ちゃんにいいとこ見せるぷに！）"],playCard:["ぷににっ！（これで決まりぷに！）","ぷにぃ！（いい感じぷに！）"],pass:["ぷにゅ〜（しかたないぷにぃ…）（パス）","ぷにっ…（今回は見送るぷに）（パス）"],giveUp:["ぷにゃぁ…（ミニばけ、負けちゃったぷに…）（ギブアップ）","ぷにぃ〜！（まだまだ修行が足りないぷに…）（ギブアップ）"],win:["ぷにぷにっ！（ミニばけ、優勝ぷに〜？）","ぷににぃ！（お兄ちゃん、見てたぷに！？）"]}}],s=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],n=["spade","heart","diamond","club"],o=e=>s.indexOf(e),i=e=>n.indexOf(e),c=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{type:"random",passChance:0},r=e.filter(e=>e.location===t&&e.isPlayable);if(0!==r.length){if(100*Math.random()<a.passChance)return;switch(a.type){case"random":return r[Math.floor(Math.random()*r.length)];case"edge":{let e=r.map(e=>{let t=o(e.rank);return{card:e,score:Math.max(t,s.length-1-t)}});return e.sort((e,t)=>t.score-e.score),e[0].card}case"center":{let e=r.map(e=>{let t=Math.abs(o(e.rank)-6);return{card:e,score:t}});return e.sort((e,t)=>e.score-t.score),e[0].card}default:return r[0]}}},d=()=>n.flatMap(e=>s.map(t=>({id:"".concat(e,"-").concat(t),suit:e,rank:t,location:"deck",isFaceUp:!1}))),p=(0,a(5453).v)((e,t)=>({npcCount:3,PASS_LIMIT:3,phase:"title",phaseSub:null,lineTimestamp:null,cards:[],currentTurnIndex:0,nextActionTime:0,passCountMap:{player:0},finishedPlayers:[],characterLines:{},setCharacterLine:(a,r)=>{e({characterLines:{...t().characterLines,[a]:{text:r,timestamp:Date.now()}}})},lastPassPlayer:{},setLastPassPlayer:(t,a)=>{e({lastPassPlayer:{player:t,type:a,timestamp:Date.now()}})},resetPassCounts:()=>{e({passCountMap:{player:0}})},startGame:()=>{e({cards:d().sort(()=>Math.random()-.5),phase:"title",currentTurnIndex:0,nextActionTime:0,passCountMap:{},lastPassPlayer:{},finishedPlayers:[],characterLines:{}})},setPhase:(t,a)=>{e({phase:t,phaseSub:a})},dealCards:()=>{let a=1+t().npcCount,r=d().sort(()=>Math.random()-.5),l=Array.from({length:a},()=>[]);r.forEach((e,t)=>{l[t%a].push(e)}),e({cards:l.flatMap((e,t)=>{let a=0===t?"player":"npc".concat(t),r=0===t;return e.map(e=>({...e,location:a,isFaceUp:r}))})})},dealNextCard:()=>{let{cards:a,npcCount:r}=t(),l=a.findLast(e=>"deck"===e.location);if(!l)return;let s=(a.length-a.filter(e=>"deck"===e.location).length)%(1+r),n=0===s?"player":"npc".concat(s),o="player"===n;e({cards:a.map(e=>e.id===l.id?{...e,location:n,isFaceUp:o}:e)})},drawCard:()=>{let a=t(),r=a.cards.find(e=>"deck"===e.location);r&&e({cards:a.cards.map(e=>e.id===r.id?{...e,location:"player",isFaceUp:!0}:e)})},playNext7ToField:()=>{e({cards:t().cards.map(e=>"7"===e.rank?{...e,location:"field",isFaceUp:!0}:e)})},playNextToField:()=>{let a=t(),r=1+a.npcCount,s=a.currentTurnIndex%r,n=0===s?"player":"npc".concat(s),o=a.cards.filter(e=>e.location===n);if(0===o.length){a.nextTurnLoop();return}let i=l.find(e=>e.id===n),d=c(a.cards,n,null==i?void 0:i.strategy);if(!d){p.getState().showParticipantLine(n,"pass"),a.handlePass(n);return}1===o.length&&a.finishPlayer(n,"win"),e({cards:a.cards.map(e=>e.id===d.id?{...e,location:"field",isFaceUp:!0}:e)}),a.nextTurnLoop()},finishPlayer:(a,r)=>{let l=t(),s=l.finishedPlayers,n=s.filter(e=>"win"===e.reason).length,o=s.filter(e=>"giveUp"===e.reason).length,i=1+l.npcCount,c="win"===r?n+1:i-o,d=l.cards.map(e=>e.location===a?{...e,location:"field",isFaceUp:!0}:e);e({finishedPlayers:[...s,{player:a,rank:c,reason:r,timestamp:Date.now()}],cards:d}),l.showParticipantLine(a,r),l.nextTurnLoop()},showParticipantLine:(e,a)=>{let r=t(),s=l.find(t=>t.id===e),n=null==s?void 0:s.lines[a];if(n&&n.length>0){let t=(e=>e[Math.floor(Math.random()*e.length)])(n);r.setCharacterLine(e,t)}},getRemainingPlayers:()=>{let e=t(),a=e.finishedPlayers.map(e=>e.player);return["player",...Array(e.npcCount).fill(0).map((e,t)=>"npc".concat(t+1))].filter(e=>!a.includes(e))},handlePass:a=>{var r;let l=t(),s=null!==(r=l.passCountMap[a])&&void 0!==r?r:0;s+1>l.PASS_LIMIT?l.finishPlayer(a,"giveUp"):(e({passCountMap:{...l.passCountMap,[a]:s+1}}),l.setLastPassPlayer(a,"pass"),l.nextTurnLoop())},nextTurnLoop:()=>{let a=t(),r=1+a.npcCount,l=(a.currentTurnIndex+1)%r;for(let t=0;t<r;t++){let t=0===l?"player":"npc".concat(l);if(a.cards.some(e=>e.location===t)){e({currentTurnIndex:l,phaseSub:"turnLoop"});return}l=(l+1)%r}console.warn("全員が手札なし（あがり）"),a.toResult()},toResult:()=>{e({cards:t().cards.map(e=>({...e,location:"field",isFaceUp:!0})),phaseSub:"result",nextActionTime:Date.now()+1e4})},playNextToDeck:()=>{e({cards:t().cards.map(e=>({...e,location:"deck",isFaceUp:!1}))})},playUserCard:a=>{let r=t(),l=r.cards.filter(e=>"player"===e.location),s=l.find(e=>e.id===a&&e.isPlayable);if(!s)return;let n=r.cards.map(e=>e.id===s.id?{...e,location:"field",isFaceUp:!0}:e);l.length<=1&&(r.finishPlayer("player","win"),r.setLastPassPlayer("player","win")),e({cards:n}),t().nextTurnLoop()},sortPlayerHand:()=>{let a=t();e({cards:[...a.cards.filter(e=>"player"===e.location).sort((e,t)=>e.suit!==t.suit?i(e.suit)-i(t.suit):o(e.rank)-o(t.rank)),...a.cards.filter(e=>"player"!==e.location)]})},updatePlayableFlags:()=>{let a=t().cards,r=new Map;a.forEach(e=>{if("field"===e.location){let t=o(e.rank),a=r.get(e.suit)||[];r.set(e.suit,[...a,t])}});let l=a.map(e=>{if("player"!==e.location&&!e.location.startsWith("npc"))return{...e,isPlayable:!1};let t=o(e.rank),a=r.get(e.suit)||[];if(!a.includes(6))return{...e,isPlayable:"7"===e.rank};let l=a.slice().sort((e,t)=>e-t),n=!1,i=6;for(;l.includes(i);)i++;i<s.length&&i===t&&(n=!0);let c=6;for(;l.includes(c);)c--;return c>=0&&c===t&&(n=!0),{...e,isPlayable:n}});return e({cards:l}),l}}));var u=a(2115);function f(){let e=p(e=>e.phase),t=p(e=>e.setPhase);return((0,u.useEffect)(()=>{if("demo"!==e)return;let a=()=>t("title",null);return window.addEventListener("keydown",a),window.addEventListener("mousedown",a),()=>{window.removeEventListener("keydown",a),window.removeEventListener("mousedown",a)}},[e,t]),"demo"!==e)?null:(0,r.jsx)("div",{className:"absolute top-0 left-0 w-full h-full flex items-center justify-center pointer-events-none z-50",children:(0,r.jsx)("p",{className:"text-white text-xl text-center animate-pulse bg-black/50 px-4 py-2 rounded shadow-md",children:"デモ中です（キーを押すとタイトルへ戻ります）"})})}function h(){let e=p(e=>e.finishedPlayers),t=e=>{let t=l.find(t=>t.id===e);return t?t.name:e};return(0,r.jsx)("div",{className:"absolute inset-0 z-99 bg-black/70 flex flex-col items-center justify-center text-white",children:(0,r.jsxs)("div",{className:"bg-green-900 p-6 rounded-lg shadow-lg",children:[(0,r.jsx)("h1",{className:"text-3xl mb-4",children:"ゲーム結果"}),(0,r.jsx)("ul",{children:e.sort((e,t)=>e.rank-t.rank).map((e,a)=>(0,r.jsxs)("li",{className:"text-lg mb-1",children:[e.rank,"位：",t(e.player),"win"===e.reason?"":"（ギブアップ）"]},a))}),(0,r.jsx)("button",{className:"mt-6 px-4 py-2 bg-blue-500 rounded hover:bg-blue-600",onClick:()=>{p.getState().setPhase("title")},children:"タイトルへ戻る"})]})})}let m={1:[{top:"50%",left:"50%"}],2:[{top:"20%",left:"50%"},{top:"80%",left:"50%"}],3:[{top:"20%",left:"50%"},{top:"50%",left:"50%"},{top:"80%",left:"50%"}],4:[{top:"20%",left:"35%"},{top:"20%",left:"65%"},{top:"80%",left:"35%"},{top:"80%",left:"65%"}],5:[{top:"20%",left:"35%"},{top:"20%",left:"65%"},{top:"50%",left:"50%"},{top:"80%",left:"35%"},{top:"80%",left:"65%"}],6:[{top:"20%",left:"35%"},{top:"50%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"50%",left:"65%"},{top:"80%",left:"65%"}],7:[{top:"20%",left:"35%"},{top:"50%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"50%",left:"65%"},{top:"80%",left:"65%"},{top:"35%",left:"50%"}],8:[{top:"20%",left:"35%"},{top:"40%",left:"35%"},{top:"60%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"40%",left:"65%"},{top:"60%",left:"65%"},{top:"80%",left:"65%"}],9:[{top:"20%",left:"35%"},{top:"40%",left:"35%"},{top:"60%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"40%",left:"65%"},{top:"60%",left:"65%"},{top:"80%",left:"65%"},{top:"50%",left:"50%"}],10:[{top:"20%",left:"35%"},{top:"35%",left:"35%"},{top:"50%",left:"35%"},{top:"65%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"35%",left:"65%"},{top:"50%",left:"65%"},{top:"65%",left:"65%"},{top:"80%",left:"65%"}]};var x=a(2596),g=a(6413),y=a(6766);function b(e){let{card:t,className:a,style:l,animate:s,onClick:n}=e,o={spade:"♠",heart:"♥",diamond:"♦",club:"♣"},i="heart"===t.suit||"diamond"===t.suit?"text-red-500":"text-black",c="A"==t.rank?1:parseInt(t.rank),d=!isNaN(c)&&c>=1&&c<=10;return(0,r.jsx)(g.P.div,{onClick:t.isPlayable&&n?n:void 0,layout:!0,layoutId:t.id,className:(0,x.$)("bg-white border rounded shadow-sm","w-[15vw] aspect-[0.7] min-w-[30px] max-w-[50px]","flex-shrink-0",a),style:l,animate:s,children:t.isFaceUp?(0,r.jsxs)(r.Fragment,{children:[("diamond"===t.suit||"heart"===t.suit)&&["A","J","Q","K"].includes(t.rank)&&(0,r.jsx)(y.default,{src:"".concat("/trumps-game","/img/").concat(t.suit,"_").concat(t.rank,".png"),alt:"",width:100,height:100,className:"absolute left-0 right-0 mx-auto h-auto max-h-full object-contain",style:{top:"50%",transform:"translateY(-50%)"}}),(0,r.jsxs)("div",{className:"absolute top-[5%] left-[5%] leading-none flex flex-col ".concat(i),children:[(0,r.jsx)("span",{className:(0,x.$)("font-bold text-[0.8em]","10"===t.rank&&"-translate-x-[0.2em]"),children:t.rank}),(0,r.jsx)("span",{className:"text-[0.7em]",children:o[t.suit]})]}),(0,r.jsxs)("div",{className:"absolute bottom-[5%] right-[5%] leading-none flex flex-col ".concat(i," rotate-180"),children:[(0,r.jsx)("span",{className:(0,x.$)("font-bold text-[0.8em]","10"===t.rank&&"-translate-x-[0.2em]"),children:t.rank}),(0,r.jsx)("span",{className:"text-[0.7em]",children:o[t.suit]})]}),d&&m[c]&&(0,r.jsx)("div",{className:"absolute inset-0",children:m[c].map((e,a)=>(0,r.jsx)("span",{className:(0,x.$)(1===c?"text-[1.8em]":"text-[1.2em]","absolute ".concat(i," card-font"),"w-4 h-4 rounded-full bg-white/60","flex items-center justify-center"),style:{top:e.top,left:e.left,transform:"translate(-50%, -50%)"},children:o[t.suit]},a))})]}):(0,r.jsx)("div",{className:"bg-blue-900 w-full h-full rounded"})})}let v=[{suit:"diamond",rank:"A",isFaceUp:!0,id:"diamond-A",location:"deck"},{suit:"heart",rank:"A",isFaceUp:!0,id:"heart-A",location:"deck"},{suit:"diamond",rank:"Q",isFaceUp:!0,id:"diamond-Q",location:"deck"},{suit:"heart",rank:"Q",isFaceUp:!0,id:"heart-Q",location:"deck"},{suit:"heart",rank:"J",isFaceUp:!0,id:"heart-J",location:"deck"},{suit:"diamond",rank:"K",isFaceUp:!0,id:"diamond-K",location:"deck"},{suit:"heart",rank:"K",isFaceUp:!0,id:"heart-K",location:"deck"}];function w(){let e=p(e=>e.setPhase),t=p(e=>e.playNextToDeck),a=(0,u.useRef)(!1);return(0,u.useEffect)(()=>{let r=()=>{a.current||(a.current=!0,t(),p.getState().startGame(),e("playing","dealing"))},l=setTimeout(()=>{a.current||(a.current=!0,p.getState().startGame(),e("demo","dealing"))},6e3);return window.addEventListener("keydown",r),window.addEventListener("mousedown",r),()=>{clearTimeout(l),window.removeEventListener("keydown",r),window.removeEventListener("mousedown",r)}},[t,e]),(0,r.jsxs)("div",{className:"text-nowrap flex flex-col items-center justify-center h-screen bg-gradient-to-b from-rose-50 via-rose-100 to-rose-200 text-rose-900",children:[(0,r.jsx)(g.P.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.8},className:"text-4xl font-bold mb-4 drop-shadow-md",children:"♥ とじょりん 7ならべ ♥"}),(0,r.jsx)("div",{className:"flex justify-center items-end gap-6 mt-8",children:v.map((e,t)=>(0,r.jsx)(g.P.div,{animate:{rotate:[-5,5,-5],y:[0,-4,0]},transition:{duration:2+.01*t,repeat:1/0,ease:"easeInOut"},children:(0,r.jsx)(b,{card:e,className:"scale-150"})},e.id))}),(0,r.jsx)("p",{className:"mt-10 text-base animate-pulse bg-white/30 text-rose-900 px-4 py-2 rounded shadow-sm",children:"クリックまたはキーを押すと開始します"})]})}let j=()=>{(0,u.useEffect)(()=>{let e=setInterval(()=>{let{phase:e,phaseSub:t,currentTurnIndex:a,nextActionTime:r,updatePlayableFlags:l,getRemainingPlayers:s,finishPlayer:n,cards:o,setPhase:i,dealNextCard:c,sortPlayerHand:d,playNext7ToField:u,playNextToField:f,handlePass:h,showParticipantLine:m}=p.getState();if(console.log("phaseSub",t),!t)return;let x=Date.now();if(!(x<r))switch(t){case"dealing":o.filter(e=>"deck"===e.location).length>0?c():i(e,"sortPlayerHand");break;case"sortPlayerHand":d(),i(e,"autoPlace7s");break;case"autoPlace7s":u(),i(e,"turnLoop");break;case"turnLoop":{let t=s();if(0===t.length){p.getState().toResult();return}if(1===t.length){p.getState().toResult(),n(t[0],"win");return}let r=l();if(0===r.filter(e=>"player"===e.location||e.location.startsWith("npc")).length){p.getState().toResult();return}p.setState({nextActionTime:x+500}),"playing"===e&&0===a?0===r.filter(e=>"player"===e.location).filter(e=>e.isPlayable).length?(m("player","pass"),h("player")):i(e,"waitingInput"):f();break}case"result":"demo"===e&&i("title")}},100);return()=>clearInterval(e)},[])},k=()=>{let[e,t]=(0,u.useState)(0);return(0,u.useEffect)(()=>{let e=()=>t(window.innerWidth);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e};var N=a(760);let P=e=>{switch(e){case"A":return 0;case"J":return 10;case"Q":return 11;case"K":return 12;default:return parseInt(e,10)-1}},C=e=>{switch(e){case"spade":default:return 0;case"heart":return 1;case"diamond":return 2;case"club":return 3}};function L(){let e=p(e=>e.cards),t=e.filter(e=>"deck"===e.location),a=e.filter(e=>"field"===e.location),l=640>k(),s=l?24:48,n=l?36:72,o=l?2:4;return(0,r.jsxs)("div",{className:"flex h-full w-full flex-row landscape:flex-row portrait:flex-col   items-center justify-center gap-4",children:[(0,r.jsx)("div",{className:"relative flex flex-col items-center gap-1 w-20 portrait:h-[6vh]",children:(0,r.jsx)("div",{className:"relative w-16 h-24",children:(0,r.jsx)(N.N,{mode:"popLayout",children:t.map((e,t)=>(0,r.jsx)("div",{className:(0,x.$)("absolute",l?"scale-50":""),style:{top:-(.25*t),left:-(.1*t),zIndex:100+t},children:(0,r.jsx)(b,{card:e})},e.id))})})}),(0,r.jsx)("div",{className:"flex flex-col items-center flex-1 landscape:h-[55vh] portrait:h-[24vh]",children:(0,r.jsx)("div",{className:"relative h-full grid grid-cols-13 gap-[2px] p-2 rounded overflow-hidden border text-black",style:{display:"grid",gridTemplateColumns:"repeat(13, ".concat(s,"px)"),gap:"".concat(o,"px"),justifyContent:"center"},children:(0,r.jsx)(N.N,{mode:"popLayout",children:a.map((e,t)=>(0,r.jsx)(b,{card:e,className:(0,x.$)("absolute",l?"scale-50":""),style:{left:"".concat(P(e.rank)*(s+o),"px"),top:"".concat(C(e.suit)*(n+o),"px"),zIndex:t}},e.id))})})}),(0,r.jsx)("div",{className:"flex flex-col items-center gap-1"})]})}function F(e){let{playerId:t,cards:a,isCompact:s=!1,isActive:n=!1,isPlayer:o=!1,cardWidth:i=60,message:c="",passCount:d,passLimit:f,onCardClick:h,onPassClick:m}=e,g=l.find(e=>e.id===t),v=g?g.name:t,w=p(e=>e.phaseSub),j=(0,u.useRef)(null),[k,P]=(0,u.useState)(600);(0,u.useEffect)(()=>{let e=()=>{j.current&&P(j.current.offsetWidth)};e();let t=new ResizeObserver(e);return j.current&&t.observe(j.current),()=>t.disconnect()},[]);let C=(0,u.useMemo)(()=>a.length*(s?i/2:i)<=k?s?i/2:i:Math.max((k-(s?i/2:i)-5)/(a.length-1),10),[a.length,s,i,k]);return(0,r.jsxs)("div",{className:(0,x.$)("relative flex flex-col items-center h-full w-full border border-dashed pt-3 pl-3",n?"border-yellow-400 shadow-yellow-400 shadow-md":"border-dashed border-white/30"),children:[(null==g?void 0:g.img)&&(0,r.jsx)(y.default,{src:"".concat("/trumps-game","/img/").concat(g.img,".png"),alt:g.name,className:"absolute bottom-0 left-0 w-10 h-10",width:100,height:100,style:{width:50,height:"auto",top:-10,left:-10,transform:"translate(30%, 70%)"}}),v&&(0,r.jsxs)("div",{className:"absolute z-50 bg-black/60 top-0 left-0 text-xs text-white px-1",children:[v,c&&o&&(0,r.jsx)("div",{className:"absolute left-0 bottom-full mb-2 z-99 flex items-center gap-2",children:(0,r.jsxs)("div",{className:"relative bg-red-500/80 text-white text-lg px-2 py-1 rounded shadow whitespace-nowrap",style:{backgroundColor:null==g?void 0:g.colors.background,color:null==g?void 0:g.colors.text,borderColor:null==g?void 0:g.colors.border,borderWidth:"2px"},children:[c,(0,r.jsx)("div",{className:"absolute left-4 top-full w-0 h-0",style:{borderLeft:"8px solid transparent",borderRight:"8px solid transparent",borderTop:"8px solid ".concat(null==g?void 0:g.colors.background)}})]})})]}),n&&o&&"waitingInput"===w&&(0,r.jsx)("div",{className:"absolute flex mt-2 z-50 top-8 left-0 gap-2 text-xs",children:(0,r.jsx)("button",{className:"bg-red-500 text-white px-4 py-1 rounded hover:bg-red-600",onClick:()=>null==m?void 0:m(),children:"パス"})}),"number"==typeof d&&"number"==typeof f&&(0,r.jsx)("div",{className:"absolute z-40 top-[18px] left-0 px-1 flex gap-[1px] text-xs pointer-events-none",children:Array.from({length:f}).map((e,t)=>(0,r.jsx)("span",{className:(0,x.$)(t<f-d?"opacity-100":"opacity-30"),children:"\uD83E\uDE99"},t))}),c&&!o&&(0,r.jsx)("div",{className:"absolute left-0 bottom-0 translate-y-full z-99 flex items-center gap-2",children:(0,r.jsxs)("div",{className:"relative text-lg px-2 py-1 rounded shadow whitespace-nowrap",style:{backgroundColor:null==g?void 0:g.colors.background,color:null==g?void 0:g.colors.text,borderColor:null==g?void 0:g.colors.border},children:[c,(0,r.jsx)("div",{className:"absolute left-4 bottom-full w-0 h-0 z-99",style:{borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderBottom:"10px solid ".concat(null==g?void 0:g.colors.border)}}),(0,r.jsx)("div",{className:"absolute left-[18px] bottom-full w-0 h-0 z-99",style:{borderLeft:"8px solid transparent",borderRight:"8px solid transparent",borderBottom:"8px solid ".concat(null==g?void 0:g.colors.background)}})]})}),(0,r.jsx)("div",{className:(0,x.$)("ml-10 relative overflow-hidden w-full",s?"h-[55px]":"h-[85px]"),style:{width:"95%",maxWidth:"100%"},ref:j,children:(0,r.jsx)(N.N,{mode:"popLayout",children:a.map((e,t)=>{let l=a.length>1?t/(a.length-1):.5,o=-(3*Math.pow(Math.abs((l-.5)*2),2));return(0,r.jsx)(b,{card:e,className:(0,x.$)("absolute top-0",s?"scale-55":"",h&&e.isPlayable&&e.isFaceUp&&n?"cursor-pointer":""),style:{left:"".concat(k>a.length*C?t*C+(k-a.length*C)/2:0,"px"),top:"".concat((e.isPlayable&&e.isFaceUp?0:10)-o-15*!!s,"px"),zIndex:t},animate:{rotate:(l-.5)*6},onClick:()=>null==h?void 0:h(e.id)},e.id)})})})]})}function E(e){var t,a;let{playerId:l}=e,s=p(e=>e.cards),n=p(e=>e.lastPassPlayer),o=p(e=>e.passCountMap),i=p(e=>e.currentTurnIndex),c=p(e=>e.characterLines[l]),d=null!==(t=null==c?void 0:c.text)&&void 0!==t?t:void 0,f=k(),h=(()=>{if("player"===l)return 0===i;let e=l.match(/^npc(\d+)$/);return!!e&&i===parseInt(e[1],10)+1})(),m=s.filter(e=>e.location===l),x=p(e=>e.handlePass),g=p(e=>e.playUserCard);return(0,u.useEffect)(()=>{if(!n||n.player!==l)return;let e=setTimeout(()=>{p.getState().setLastPassPlayer()},1500);return()=>clearTimeout(e)},[n,l]),(0,u.useEffect)(()=>{let e=setInterval(()=>{let e={...p.getState().characterLines},t=Date.now();Object.entries(e).forEach(a=>{let[r,l]=a;l&&t-l.timestamp>2e3&&(e[r]=null)}),p.setState({characterLines:e})},500);return()=>clearInterval(e)},[]),(0,r.jsx)("div",{className:"flex-1 flex-col items-center justify-center",children:(0,r.jsx)(F,{playerId:l,cards:m,isCompact:f<640,isActive:h,isPlayer:"player"===l,message:d,passCount:null!==(a=o[l])&&void 0!==a?a:0,passLimit:3,onCardClick:e=>{g(e)},onPassClick:()=>{x("player")}})})}function T(){let e=p(e=>e.npcCount),t=Array.from({length:e},(e,t)=>{let a="npc".concat(t+1);return(0,r.jsx)(E,{playerId:a},a)}),a=(()=>{switch(e){case 2:return"portrait:grid portrait:grid-cols-2 portrait:grid-rows-1";case 3:return"portrait:grid portrait:grid-cols-2 portrait:grid-rows-2 portrait:[&>div:nth-child(1)]:col-span-2 portrait:[&>div:nth-child(1)]:justify-center";case 4:return"portrait:grid portrait:grid-cols-2 portrait:grid-rows-2";default:return"portrait:flex portrait:flex-row"}})();return(0,r.jsx)("div",{className:"w-full landscape:flex landscape:flex-row gap-1 ".concat(a),children:t})}function I(){return(0,r.jsxs)("div",{className:"flex justify-between items-center h-full",children:[(0,r.jsx)("div",{className:"flex flex-col items-center gap-1 landscape:w-[20vw]"}),(0,r.jsx)(E,{playerId:"player"},"player"),(0,r.jsx)("div",{className:"flex flex-col items-center gap-1 landscape:w-[20vw]"})]})}function S(){return(0,r.jsxs)("main",{className:"flex-col h-screen bg-green-900 text-white",children:[(0,r.jsx)("section",{className:"landscape:h-[21vh] portrait:h-[20vh]",children:(0,r.jsx)(T,{})}),(0,r.jsx)("section",{className:"landscape:h-[58vh] portrait:h-[42vh]",children:(0,r.jsx)(L,{})}),(0,r.jsx)("section",{className:"landscape:h-[21vh] portrait:h-[15vh]",children:(0,r.jsx)(I,{})}),(0,r.jsx)(f,{})]})}function U(){let e=p(e=>e.phase),t=p(e=>e.phaseSub);return(j(),"title"===e)?(0,r.jsx)(w,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S,{}),"result"===t&&(0,r.jsx)(h,{})," "]})}function M(){let e=(0,u.useRef)(!1);return(0,u.useEffect)(()=>{e.current||(p.getState().startGame(),e.current=!0)},[]),(0,u.useEffect)(()=>{/Android/i.test(navigator.userAgent)&&document.body.classList.add("android")},[]),(0,u.useEffect)(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/trumps-game/service-worker.js")},[]),(0,r.jsx)(U,{})}},2659:(e,t,a)=>{Promise.resolve().then(a.bind(a,562))}},e=>{var t=t=>e(e.s=t);e.O(0,[411,441,684,358],()=>t(2659)),_N_E=e.O()}]);