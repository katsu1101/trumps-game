(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2659:(e,t,a)=>{Promise.resolve().then(a.bind(a,5376))},5376:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>L});var s=a(5155);let r=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],l=["spade","heart","diamond","club"],n=e=>r.indexOf(e),o=e=>l.indexOf(e),c=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"random",s=e.filter(e=>e.location===t&&e.isPlayable);if(0!==s.length)switch(a){case"random":return s[Math.floor(Math.random()*s.length)];case"edge":{let e=s.map(e=>{let t=n(e.rank);return{card:e,score:Math.max(t,r.length-1-t)}});return e.sort((e,t)=>t.score-e.score),e[0].card}case"center":{let e=s.map(e=>{let t=Math.abs(n(e.rank)-6);return{card:e,score:t}});return e.sort((e,t)=>e.score-t.score),e[0].card}default:return s[0]}},i=()=>l.flatMap(e=>r.map(t=>({id:"".concat(e,"-").concat(t),suit:e,rank:t,location:"deck",isFaceUp:!1}))),d=(0,a(5453).v)((e,t)=>({npcCount:3,phase:"title",phaseSub:null,cards:[],currentTurnIndex:0,passCountMap:{player:0},lastPassPlayer:null,setLastPassPlayer:t=>e({lastPassPlayer:t}),resetPassCounts:()=>{e({passCountMap:{player:0}})},startGame:()=>{let{npcCount:a,passCountMap:s}=t(),r=i().sort(()=>Math.random()-.5);for(let e=1;e<=a;e++)s["npc".concat(e)]=0;e({cards:r,phase:"title",currentTurnIndex:0,passCountMap:s})},setPhase:(t,a)=>{e({phase:t,phaseSub:a})},dealCards:()=>{let a=1+t().npcCount,s=i().sort(()=>Math.random()-.5),r=Array.from({length:a},()=>[]);s.forEach((e,t)=>{r[t%a].push(e)}),e({cards:r.flatMap((e,t)=>{let a=0===t?"player":"npc".concat(t-1),s=0===t;return e.map(e=>({...e,location:a,isFaceUp:s}))})})},dealNextCard:()=>{let{cards:a,npcCount:s}=t(),r=a.findLast(e=>"deck"===e.location);if(!r)return;let l=(a.length-a.filter(e=>"deck"===e.location).length)%(1+s),n=0===l?"player":"npc".concat(l-1),o="player"===n;e({cards:a.map(e=>e.id===r.id?{...e,location:n,isFaceUp:o}:e)})},drawCard:()=>{let a=t(),s=a.cards.find(e=>"deck"===e.location);s&&e({cards:a.cards.map(e=>e.id===s.id?{...e,location:"player",isFaceUp:!0}:e)})},playNext7ToField:()=>{e({cards:t().cards.map(e=>"7"===e.rank?{...e,location:"field",isFaceUp:!0}:e)})},playNextToField:a=>{let s=t(),r=1+s.npcCount,l=s.currentTurnIndex%r,n=0===l?"player":"npc".concat(l-1);if(!a&&0===l)return;let o=(()=>{switch(n){case"player":return"edge";case"npc1":return"random";case"npc2":return"center";default:return"first"}})();if(0===s.cards.filter(e=>e.location===n).length)return;let i=c(s.cards,n,o);if(!i){let t=s.passCountMap[n]||0;if(t>=3){e({cards:s.cards.map(e=>e.location===n?{...e,location:"field",isFaceUp:!0}:e),passCountMap:{...s.passCountMap,[n]:t+1}});return}e(e=>({passCountMap:{...e.passCountMap,[n]:t+1}})),s.setLastPassPlayer(n);return}e({cards:s.cards.map(e=>e.id===i.id?{...e,location:"field",isFaceUp:!0}:e)})},nextTurnLoop:()=>{let a=t(),s=1+a.npcCount,r=(a.currentTurnIndex+1)%s;for(let t=0;t<s;t++){let t=0===r?"player":"npc".concat(r-1);if(a.cards.some(e=>e.location===t)){e({currentTurnIndex:r});return}r=(r+1)%s}console.warn("全員が手札なし（あがり）"),e({phaseSub:"result"})},playNextToDeck:()=>{e({cards:t().cards.map(e=>({...e,location:"deck",isFaceUp:!1}))})},sortPlayerHand:()=>{let a=t();e({cards:[...a.cards.filter(e=>"player"===e.location).sort((e,t)=>e.suit!==t.suit?o(e.suit)-o(t.suit):n(e.rank)-n(t.rank)),...a.cards.filter(e=>"player"!==e.location)]})},updatePlayableFlags:()=>{let a=t().cards,s=new Map;a.forEach(e=>{if("field"===e.location){let t=n(e.rank),a=s.get(e.suit)||[];s.set(e.suit,[...a,t])}}),e({cards:a.map(e=>{if("player"!==e.location&&!e.location.startsWith("npc"))return{...e,isPlayable:!1};let t=n(e.rank),a=s.get(e.suit)||[];if(!a.includes(6))return{...e,isPlayable:"7"===e.rank};let l=a.slice().sort((e,t)=>e-t),o=!1,c=6;for(;l.includes(c);)c++;c<r.length&&c===t&&(o=!0);let i=6;for(;l.includes(i);)i--;return i>=0&&i===t&&(o=!0),{...e,isPlayable:o}})})}}));var p=a(2115);function u(){let e=d(e=>e.phase),t=d(e=>e.setPhase);return((0,p.useEffect)(()=>{if("demo"!==e)return;let a=()=>t("title",null);return window.addEventListener("keydown",a),window.addEventListener("mousedown",a),()=>{window.removeEventListener("keydown",a),window.removeEventListener("mousedown",a)}},[e,t]),"demo"!==e)?null:(0,s.jsx)("div",{className:"absolute top-0 left-0 w-full h-full flex items-center justify-center pointer-events-none z-50",children:(0,s.jsx)("div",{className:"text-white text-xl text-center animate-pulse bg-black/50 px-4 py-2 rounded shadow-md",children:"デモ中です（キーを押すとタイトルへ戻ります）"})})}let f={1:[{top:"50%",left:"50%"}],2:[{top:"20%",left:"50%"},{top:"80%",left:"50%"}],3:[{top:"20%",left:"50%"},{top:"50%",left:"50%"},{top:"80%",left:"50%"}],4:[{top:"20%",left:"35%"},{top:"20%",left:"65%"},{top:"80%",left:"35%"},{top:"80%",left:"65%"}],5:[{top:"20%",left:"35%"},{top:"20%",left:"65%"},{top:"50%",left:"50%"},{top:"80%",left:"35%"},{top:"80%",left:"65%"}],6:[{top:"20%",left:"35%"},{top:"50%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"50%",left:"65%"},{top:"80%",left:"65%"}],7:[{top:"20%",left:"35%"},{top:"50%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"50%",left:"65%"},{top:"80%",left:"65%"},{top:"35%",left:"50%"}],8:[{top:"20%",left:"35%"},{top:"40%",left:"35%"},{top:"60%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"40%",left:"65%"},{top:"60%",left:"65%"},{top:"80%",left:"65%"}],9:[{top:"20%",left:"35%"},{top:"40%",left:"35%"},{top:"60%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"40%",left:"65%"},{top:"60%",left:"65%"},{top:"80%",left:"65%"},{top:"50%",left:"50%"}],10:[{top:"20%",left:"35%"},{top:"35%",left:"35%"},{top:"50%",left:"35%"},{top:"65%",left:"35%"},{top:"80%",left:"35%"},{top:"20%",left:"65%"},{top:"35%",left:"65%"},{top:"50%",left:"65%"},{top:"65%",left:"65%"},{top:"80%",left:"65%"}]};var h=a(2596),x=a(6413),m=a(6766);function w(e){let{card:t,className:a,style:r,animate:l}=e,n={spade:"♠",heart:"♥",diamond:"♦",club:"♣"},o="heart"===t.suit||"diamond"===t.suit?"text-red-500":"text-black",c="A"==t.rank?1:parseInt(t.rank),i=!isNaN(c)&&c>=1&&c<=10;return(0,s.jsx)(x.P.div,{layout:!0,layoutId:t.id,className:(0,h.$)("bg-white border rounded shadow-sm","w-[15vw] aspect-[0.7] min-w-[30px] max-w-[50px]","flex-shrink-0",a),style:r,animate:l,children:t.isFaceUp?(0,s.jsxs)(s.Fragment,{children:[("diamond"===t.suit||"heart"===t.suit)&&["A","J","Q","K"].includes(t.rank)&&(0,s.jsx)(m.default,{src:"".concat("/trumps-game","/img/").concat(t.suit,"_").concat(t.rank,".png"),alt:"",width:100,height:100,className:"absolute left-0 right-0 mx-auto h-auto max-h-full object-contain",style:{top:"50%",transform:"translateY(-50%)"}}),(0,s.jsxs)("div",{className:"absolute top-[5%] left-[5%] leading-none flex flex-col ".concat(o),children:[(0,s.jsx)("span",{className:(0,h.$)("font-bold text-[0.8em]","10"===t.rank&&"-translate-x-[0.2em]"),children:t.rank}),(0,s.jsx)("span",{className:"text-[0.7em]",children:n[t.suit]})]}),(0,s.jsxs)("div",{className:"absolute bottom-[5%] right-[5%] leading-none flex flex-col ".concat(o," rotate-180"),children:[(0,s.jsx)("span",{className:(0,h.$)("font-bold text-[0.8em]","10"===t.rank&&"-translate-x-[0.2em]"),children:t.rank}),(0,s.jsx)("span",{className:"text-[0.7em]",children:n[t.suit]})]}),i&&f[c]&&(0,s.jsx)("div",{className:"absolute inset-0",children:f[c].map((e,a)=>(0,s.jsx)("span",{className:(0,h.$)(1===c?"text-[1.8em]":"text-[1.2em]","absolute ".concat(o," card-font"),"w-4 h-4 rounded-full bg-white/60","flex items-center justify-center"),style:{top:e.top,left:e.left,transform:"translate(-50%, -50%)"},children:n[t.suit]},a))})]}):(0,s.jsx)("div",{className:"bg-blue-900 w-full h-full rounded"})})}let y=[{suit:"diamond",rank:"A",isFaceUp:!0,id:"diamond-A",location:"deck"},{suit:"heart",rank:"A",isFaceUp:!0,id:"heart-A",location:"deck"},{suit:"diamond",rank:"Q",isFaceUp:!0,id:"diamond-Q",location:"deck"},{suit:"heart",rank:"Q",isFaceUp:!0,id:"heart-Q",location:"deck"},{suit:"heart",rank:"J",isFaceUp:!0,id:"heart-J",location:"deck"},{suit:"diamond",rank:"K",isFaceUp:!0,id:"diamond-K",location:"deck"},{suit:"heart",rank:"K",isFaceUp:!0,id:"heart-K",location:"deck"}];function g(){let e=d(e=>e.setPhase),t=d(e=>e.playNextToDeck),a=(0,p.useRef)(!1);return(0,p.useEffect)(()=>{let s=()=>{a.current||(a.current=!0,t(),d.getState().resetPassCounts(),e("playing","dealing"))},r=setTimeout(()=>{a.current||(a.current=!0,d.getState().resetPassCounts(),e("demo","dealing"))},6e3);return window.addEventListener("keydown",s),window.addEventListener("mousedown",s),()=>{clearTimeout(r),window.removeEventListener("keydown",s),window.removeEventListener("mousedown",s)}},[t,e]),(0,s.jsxs)("div",{className:"text-nowrap flex flex-col items-center justify-center h-screen bg-gradient-to-b from-rose-50 via-rose-100 to-rose-200 text-rose-900",children:[(0,s.jsx)(x.P.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.8},className:"text-4xl font-bold mb-4 drop-shadow-md",children:"♥ とじょりん 7ならべ ♥"}),(0,s.jsx)("div",{className:"flex justify-center items-end gap-6 mt-8",children:y.map((e,t)=>(0,s.jsx)(x.P.div,{animate:{rotate:[-5,5,-5],y:[0,-4,0]},transition:{duration:2+.01*t,repeat:1/0,ease:"easeInOut"},children:(0,s.jsx)(w,{card:e,className:"scale-150"})},e.id))}),(0,s.jsx)("p",{className:"mt-10 text-base animate-pulse bg-white/30 text-rose-900 px-4 py-2 rounded shadow-sm",children:"クリックまたはキーを押すと開始します"})]})}let b=e=>new Promise(t=>setTimeout(t,e)),v=()=>{let e=d(e=>e.dealNextCard),t=d(e=>e.sortPlayerHand),a=d(e=>e.playNextToField),s=d(e=>e.playNext7ToField),r=d(e=>e.playNextToDeck),l=d(e=>e.phase),n=d(e=>e.phaseSub),o=d(e=>e.setPhase);(0,p.useEffect)(()=>{let c=!1;return(async()=>{switch(console.log("phaseSub",n),n){case null:break;case"dealing":for(;!c;)if(d.getState().cards.filter(e=>"deck"===e.location).length>0)e(),await b(100);else{d.setState({phaseSub:"sortPlayerHand"});break}break;case"sortPlayerHand":t(),await b(500),d.setState({phaseSub:"autoPlace7s"});break;case"autoPlace7s":s(),await b(500),d.setState({phaseSub:"turnLoop"});break;case"turnLoop":for(;!c;)if(d.getState().updatePlayableFlags(),d.getState().cards.filter(e=>"player"===e.location||e.location.startsWith("npc")).length>0)await b(500),d.getState().updatePlayableFlags(),a("demo"===l),await b(500),d.getState().nextTurnLoop();else{await b(5e3),d.setState({phaseSub:"result"});break}break;case"result":d.setState({phaseSub:"playNextToDeck"});break;case"playNextToDeck":r(),o("title",null);break;default:console.log("phaseSub: ".concat(n))}})().then(()=>{}),()=>{c=!0}},[n,e,t,a,s,r,o,l])},j=()=>{let[e,t]=(0,p.useState)(0);return(0,p.useEffect)(()=>{let e=()=>t(window.innerWidth);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e};var k=a(760);let N=e=>{switch(e){case"A":return 0;case"J":return 10;case"Q":return 11;case"K":return 12;default:return parseInt(e,10)-1}},P=e=>{switch(e){case"spade":default:return 0;case"heart":return 1;case"diamond":return 2;case"club":return 3}};function C(){let e=d(e=>e.cards),t=e.filter(e=>"deck"===e.location),a=e.filter(e=>"field"===e.location),r=640>j(),l=r?24:48,n=r?36:72,o=r?2:4;return(0,s.jsxs)("div",{className:"flex h-full w-full flex-row landscape:flex-row portrait:flex-col   items-center justify-center gap-4",children:[(0,s.jsx)("div",{className:"relative flex flex-col items-center gap-1 w-20 portrait:h-[6vh]",children:(0,s.jsx)("div",{className:"relative w-16 h-24",children:(0,s.jsx)(k.N,{mode:"popLayout",children:t.map((e,t)=>(0,s.jsx)("div",{className:(0,h.$)("absolute",r?"scale-50":""),style:{top:-(.25*t),left:-(.1*t),zIndex:100+t},children:(0,s.jsx)(w,{card:e})},e.id))})})}),(0,s.jsx)("div",{className:"flex flex-col items-center flex-1 landscape:h-[55vh] portrait:h-[24vh]",children:(0,s.jsx)("div",{className:"relative h-full grid grid-cols-13 gap-[2px] p-2 rounded overflow-hidden border text-black",style:{display:"grid",gridTemplateColumns:"repeat(13, ".concat(l,"px)"),gap:"".concat(o,"px"),justifyContent:"center"},children:(0,s.jsx)(k.N,{mode:"popLayout",children:a.map((e,t)=>(0,s.jsx)(w,{card:e,className:(0,h.$)("absolute",r?"scale-50":""),style:{left:"".concat(N(e.rank)*(l+o),"px"),top:"".concat(P(e.suit)*(n+o),"px"),zIndex:t}},e.id))})})}),(0,s.jsx)("div",{className:"flex flex-col items-center gap-1"})]})}function S(e){let{cards:t,label:a,isCompact:r=!1,isActive:l=!1,cardWidth:n=60,message:o="",passCount:c,passLimit:i}=e,d=(0,p.useRef)(null),[u,f]=(0,p.useState)(600);(0,p.useEffect)(()=>{let e=()=>{d.current&&f(d.current.offsetWidth)};e();let t=new ResizeObserver(e);return d.current&&t.observe(d.current),()=>t.disconnect()},[]);let x=(0,p.useMemo)(()=>t.length*(r?n/2:n)<=u?r?n/2:n:Math.max((u-(r?n/2:n)-5)/(t.length-1),10),[t.length,r,n,u]);return(0,s.jsxs)("div",{className:(0,h.$)("relative flex flex-col items-center h-full w-full border border-dashed pt-3 pl-3",l?"border-yellow-400 shadow-yellow-400 shadow-md":"border-dashed border-white/30"),children:[a&&(0,s.jsx)("div",{className:"absolute z-50 bg-black/60 top-0 left-0 text-xs text-white px-1",children:a}),"number"==typeof c&&"number"==typeof i&&(0,s.jsx)("div",{className:"absolute z-40 top-[18px] left-0 px-1 flex gap-[1px] text-xs pointer-events-none",children:Array.from({length:i}).map((e,t)=>(0,s.jsx)("span",{className:(0,h.$)(t<i-c?"opacity-100":"opacity-30"),children:"\uD83E\uDE99"},t))}),o&&(0,s.jsx)("div",{className:"text-nowrap absolute z-40 left-1/2 -translate-x-1/2 text-sm text-white bg-red-500/80 px-2 py-1 rounded shadow",children:o}),(0,s.jsx)("div",{className:(0,h.$)("relative overflow-hidden w-full",r?"h-[55px]":"h-[85px]"),style:{width:"100%",maxWidth:"100%"},ref:d,children:(0,s.jsx)(k.N,{mode:"popLayout",children:t.map((e,a)=>{let l=t.length>1?a/(t.length-1):.5,n=-(3*Math.pow(Math.abs((l-.5)*2),2));return(0,s.jsx)(w,{card:e,className:(0,h.$)("absolute top-0",r?"scale-50":""),style:{left:"".concat(u>t.length*x?a*x+(u-t.length*x)/2:0,"px"),top:"".concat((e.isPlayable&&e.isFaceUp?0:r?-10:10)-n,"px"),zIndex:a},animate:{rotate:(l-.5)*6}},e.id)})})})]})}function E(){let e=d(e=>e.cards),t=d(e=>e.npcCount),a=d(e=>e.currentTurnIndex),r=d(e=>e.lastPassPlayer),l=d(e=>e.passCountMap),n=640>j();(0,p.useEffect)(()=>{if(!r)return;let e=setTimeout(()=>{d.getState().setLastPassPlayer(null)},1500);return()=>clearTimeout(e)},[r]);let o=Array.from({length:t},(t,o)=>{var c;let i=e.filter(e=>e.location==="npc".concat(o)),d=a===o+1;return(0,s.jsx)("div",{className:"flex-1 flex-col items-center justify-center",children:(0,s.jsx)(S,{cards:i,label:"NPC ".concat(o+1),isCompact:n,isActive:d,message:r==="npc".concat(o)?"パスしました":void 0,passCount:null!==(c=l["npc".concat(o)])&&void 0!==c?c:0,passLimit:3})},"npc".concat(o))}),c=(()=>{switch(t){case 2:return"portrait:grid portrait:grid-cols-2 portrait:grid-rows-1";case 3:return"portrait:grid portrait:grid-cols-2 portrait:grid-rows-2 portrait:[&>div:nth-child(1)]:col-span-2 portrait:[&>div:nth-child(1)]:justify-center";case 4:return"portrait:grid portrait:grid-cols-2 portrait:grid-rows-2";default:return"portrait:flex portrait:flex-row"}})();return(0,s.jsx)("div",{className:"w-full landscape:flex landscape:flex-row gap-1 ".concat(c),children:o})}function M(){var e;let t=d(e=>e.cards),a=d(e=>e.currentTurnIndex),r=d(e=>e.passCountMap),l=(0,p.useMemo)(()=>t.filter(e=>"player"===e.location),[t]);return(0,s.jsxs)("div",{className:"flex justify-between items-center h-full",children:[(0,s.jsx)("div",{className:"flex flex-col items-center gap-1 landscape:w-[20vw]"}),(0,s.jsx)(S,{cards:l,label:"\uD83E\uDDD1 プレイヤー",isCompact:!1,isActive:0===a,passCount:null!==(e=r.player)&&void 0!==e?e:0,passLimit:3}),(0,s.jsx)("div",{className:"flex flex-col items-center gap-1 landscape:w-[20vw]"})]})}function T(){return(0,s.jsxs)("main",{className:"flex-col h-screen bg-green-900 text-white",children:[(0,s.jsx)("section",{className:"landscape:h-[21vh] portrait:h-[20vh]",children:(0,s.jsx)(E,{})}),(0,s.jsx)("section",{className:"landscape:h-[58vh] portrait:h-[42vh]",children:(0,s.jsx)(C,{})}),(0,s.jsx)("section",{className:"landscape:h-[21vh] portrait:h-[15vh]",children:(0,s.jsx)(M,{})}),(0,s.jsx)(u,{})]})}function F(){let e=d(e=>e.phase);return(v(),"title"===e)?(0,s.jsx)(g,{}):(0,s.jsx)(T,{})}function L(){let e=(0,p.useRef)(!1);return(0,p.useEffect)(()=>{e.current||(d.getState().startGame("auto"),e.current=!0)},[]),(0,s.jsx)(F,{})}}},e=>{var t=t=>e(e.s=t);e.O(0,[411,441,684,358],()=>t(2659)),_N_E=e.O()}]);